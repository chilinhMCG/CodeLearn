@page "/course-type/delete/{id}"
@attribute [Authorize(Roles = "Admin")]
@inject ICourseTypeRepository CourseTypeRepository
@inject ICourseRepository CourseRepository
@inject ISnackbar Snackbar
@inject IJSRuntime JSRuntime

<MudPaper Class="p-4">
    <MudItem lg="12">
        <MudText Typo="Typo.h6" Color="Color.Success">Bạn có chắc muốn xóa nhóm khóa học này?</MudText>
        <MudText Class="text-center" Typo="Typo.h4">@currentCourseType.Name</MudText>
    </MudItem>
    <MudItem lg="12" Class="text-center">
        <MudButton Color="Color.Success" @onclick="DeleteAsync">Xóa</MudButton>
        <MudButton Color="Color.Dark">
            <MudLink Href="/admin/course-type-manager" Color="Color.Dark" Underline="Underline.None">Quay lại</MudLink>
        </MudButton>
    </MudItem>
    
</MudPaper>


@code {
        [Parameter]
        public string ID { get; set; }

    protected List<CourseType> courseTypes { get; set; }

    protected List<Course> courses { get; set; }

    protected CourseType currentCourseType { get; set; }

    protected override void OnInitialized()
    {
        courses = CourseRepository.GetAllCourse();
        courseTypes = CourseTypeRepository.GetAllCourseType();
        currentCourseType = courseTypes.FirstOrDefault(x => x.Id.ToString() == this.ID);
    }

    protected async Task DeleteAsync()
    {
        if (courses.Any(x => x.CourseTypeId.ToString() == this.ID))
        {
            Snackbar.Add("Trong loại khóa học này vẫn còn khóa học!!! Vui lòng xóa hết khóa học để xóa được loại này!", Severity.Warning);
        }
        else
        {
            CourseTypeRepository.DeleteCourseType(currentCourseType);
            await JSRuntime.InvokeVoidAsync("RedirectToCourseType");
        }
    }
}
