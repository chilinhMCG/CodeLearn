@page "/admin/course/edit/{id}"
@attribute [Authorize(Roles = "Admin")]
@inject ISnackbar Snackbar
@inject ICourseTypeRepository CourseTypeRepository
@inject ICourseRepository CourseRepository
@inject IJSRuntime JSRuntime


<MudPaper Class="p-4">
    <MudItem>
        <MudText Class="text-center" Color="Color.Success" Typo="Typo.h3">Chỉnh sửa khóa học</MudText>
    </MudItem>
</MudPaper>
<br />
<MudPaper Class="m-auto p-4">
    <MudForm Model="currentCourse" @bind-IsValid="@formSuccess">
        <MudItem>
            <MudTextField Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="currentCourse.Name"
                          Label="Tên khóa học" Required="true"></MudTextField>
        </MudItem>
        <br />


        <MudItem>
            <MudTextField Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="currentCourse.Author"
                          Label="Tác giả" Required="true"></MudTextField>
        </MudItem>
        <br />


        <MudItem>
            <MudSelect T="Guid" Label="Thuộc loại khóa học" Required="true" @bind-Value="currentCourse.CourseTypeId">
                @foreach (var item in courseTypes)
                {
                    <MudSelectItem Value="item.Id">@item.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <br />





        <MudItem>
            <MudTextField Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="currentCourse.Thumbnail"
                          Label="Thumbnail" Lines="2" Required="true"
                          Placeholder="Tên file ảnh, vui lòng để hình vào thư mục wwwroot/images/CoursesImg của project."></MudTextField>
        </MudItem>
        <br />


        <MudItem>
            <MudNumericField Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="currentCourse.Rating"
                             Label="Rating" Min="0" Max="5" Required="true" Placeholder="Rating từ 0 đến 5"></MudNumericField>
        </MudItem>
        <br />


        <MudItem>
            <MudSelect T="CourseStatusEnum" Label="Status" Required="true" @bind-Value="currentCourse.Status">
                <MudSelectItem Value="CourseStatusEnum.Free" />
                <MudSelectItem Value="CourseStatusEnum.Block" />
                <MudSelectItem Value="CourseStatusEnum.Updating" />
                <MudSelectItem Value="CourseStatusEnum.Cancel" />
            </MudSelect>
        </MudItem>
        <br />


        <MudItem>
            <MudTextField Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="currentCourse.Description"
                          Label="Mô tả" Lines="10" Required="true"></MudTextField>
        </MudItem>
        <br />



        <MudItem Class="text-center">
            <MudButton Color="Color.Success" @onclick="EditAsync" Disabled="@(!formSuccess)">Update</MudButton>
            <MudButton Color="Color.Dark">
                <MudLink Color="Color.Dark" Underline="Underline.None" Href="admin/course-manager">Quay lại</MudLink>
            </MudButton>
        </MudItem>
    </MudForm>
</MudPaper>

@code {

    protected bool formSuccess { get; set; }

    [Parameter]
    public string ID { get; set; }

    protected Course currentCourse { get; set; } = new Course();

    protected List<Course> courses { get; set; } = new List<Course>();

    protected List<CourseType> courseTypes { get; set; } = new List<CourseType>();

    protected override void OnInitialized()
    {

        courseTypes = CourseTypeRepository.GetAllCourseType();
        courses = CourseRepository.GetAllCourse();
        currentCourse = courses.FirstOrDefault(x => x.Id.ToString() == this.ID);


    }

    protected async Task EditAsync()
    {
        CourseRepository.UpdateCourse(currentCourse);
        await JSRuntime.InvokeVoidAsync("RedirectToCourse");
    }

}